<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#2196f3">
  <meta http-equiv="Content-Security-Policy" content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: gap:">
  <title>Booked</title>
  <link rel="stylesheet" href="dist/css/framework7.min.css">
  <link rel="stylesheet" href="css/app.css">
  <link rel="apple-touch-icon" href="img/f7-icon-square.png">
  <link rel="icon" href="img/f7-icon.png">

  
  
</head>

<body class="color-theme-red">
  <div id="app">
    <div class="statusbar"></div>
    <div class="view view-main view-init ios-edges navbar-custom" data-url="/">
      <div class="page">
        <div class="navbar">
          <div class="navbar-inner sliding ">
            <div class="left header-section">
              <img src="img/booked_logo.jpg" class="navbar-logo">
              <div><b>My Account Information...</b></div>
            </div>
            <div class="right my-profile-navabar" onclick="goedit();">
              <a href="#">
                <img src="img/avatar.jpg" class="img-circle">
              <span>Edit</span>
              </a>
            </div>
          </div>
        </div>
        <div class="page-content hide-navbar-on-scroll white-bg pb-xlg edit-profile">
          <div class="block p-none">
            <div class="block mb-xs">
              <p><b>Edit: About Me</b> </p>
            </div>
            <div class="grey-bg" style="background:#f2f2f2; padding:5px;">
      <div class="list inline-labels no-hairlines-md mt-sm mb-xs">
              <ul>
                <li class="item-content item-input">
                  <div class="item-inner">
                    <div class="item-title item-label">My First Name:</div>
                    <div class="item-input-wrap">
                      <input id="firstname" type="text" placeholder="">
                      <span class="input-clear-button" style="top: 20px;"></span>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
            <div class="list no-hairlines-md mt-xs">
      
              <ul>
                <li class="item-content item-input mt-xs">
                  <div class="item-inner no-border">
                    <div class="item-title item-label">My Occupation</div>
                    <div class="item-input-wrap">
                      <input id="occupation" type="text" placeholder="">
                      <span class="input-clear-button" style="top: 14px;"></span>
                    </div>
                  </div>
                </li>
                <li class="item-content item-input mt-xs">
                  <div class="item-inner no-border">
                    <div class="item-title item-label">The Area/Neighborhood where I live</div>
                    <div class="item-input-wrap">
                      <input id="area" type="text" placeholder="">
                      <span class="input-clear-button" style="top: 14px;"></span>
                    </div>
                  </div>
                </li>
                <li class="item-content item-input mt-xs">
                  <div class="item-inner no-border">mem1
                    <div class="item-title item-label">My Headline</div>
                    <div class="item-input-wrap">
                      <textarea id="headline" placeholder=""></textarea>
                    </div>
                  </div>
                </li>
                <li class="item-content">
                  <p class="m-xs" style="line-height:1"><small>We need a few words that sum you up.  If you can't think of anything, simply use one of your favorite quotes such as "Dance like nobody's watching" - Mark Twain</small></p>
                </li>
              </ul>
            </div>
      </div>
      <div class="block mt-xs mb-xs white-bg">
              <p><b>Edit: My Photos</b> </p>
            </div>
            <div class="grey-bg" style="background:#f2f2f2; padding:5px;">
      <div class="block mt-sm mb-sm">
              <div class="row">
                <div class="col-33">
                  <label class="uploaded-image">
                    <span id="delimg1" onclick="deleteimage(this.id);" class="img-delete">x</span>
                    <img id="image1" onclick="loadimage(this.id);" src="img/addimage.png" class="img-responsive">
                    <!-- <span class="upload-edit"><i class="icon material-icons">mode_edit</i>Edit</span> -->
                  </label>
                    <label><input id="prime1" type="radio" name="photo" value="1" checked>
                    Set as Primary</label>          
                </div>
                <div class="col-33">
                  <label class="uploaded-image">
                    <span id="delimg2" onclick="deleteimage(this.id);" class="img-delete">x</span>
                    <img id="image2" onclick="loadimage(this.id);" src="img/addimage.png" class="img-responsive">
                    <!--<span class="upload-edit"><i class="icon material-icons">mode_edit</i>Edit</span>-->
                  </label>
                    <label><input id="prime2" type="radio" name="photo" value="2" >
                    Set as Primary</label>          
                </div>
                <div class="col-33">
                  <label class="uploaded-image">
                    <span id="delimg3" onclick="deleteimage(this.id);" class="img-delete">x</span>
                    <img id="image3" onclick="loadimage(this.id);" src="img/addimage.png" class="img-responsive">
                    <!--<span class="upload-edit"><i class="icon material-icons">mode_edit</i>Edit</span>-->
                  </label>
                    <label><input id="prime3" type="radio" name="photo" value="3">
                    Set as Primary</label>      
                </div>
              </div>
            </div>
          
          </div>
      <a href="#" onclick="saveprofile();" class="col button button-big button-fill grey-bg-button button-block link external mt-lg">Save and View</a>  
      
      <a href="#" onclick="logout();" class="col button button-big button-fill grey-bg-button button-block link external mt-lg">Developer Only (Logout)</a>  
    
      <br>
      
      </div>
      

        </div>
        <div class="toolbar tabbar-labels">
          <div class="toolbar-inner">
            <a href="#tab-1" class="tab-link tab-link-active"><i class="icon f7-icons ios-only">info_fill</i><span class="tabbar-label">Alerts</span></a>
            <a href="#tab-2" onclick="finddates();" class="tab-link"><i class="icon material-icons">my_location<span class="badge color-red">5</span></i><span class="tabbar-label">Find Dates</span></a>
            <a href="#tab-3" onclick="gosettings();" class="tab-link"><i class="icon f7-icons ios-only">alarm</i><span class="tabbar-label">My Schedule</span></a>
            <a href="#tab-4" class="tab-link"><i class="icon material-icons ios-only">open_in_new</i><span class="tabbar-label">Post a Date</span></a>
            <a href="#tab-5" onclick="chat();" class="tab-link"><i class="icon material-icons ios-only">question_answer</i><span class="tabbar-label">Chat</span></a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script src="dist/js/framework7.min.js"></script>
  <script src="js/routes.js"></script>
  <script src="js/app.js"></script>
  <script type="text/javascript">
    $('.library-alert').on('click', function() {
      app.dialog.confirm('Allow "Booked" to access your photo library?');
   });
    

  function finddates()
  {
    window.location.href = "empty-dashboard.html";
  }
  
  function chat()
  {
    window.location.href = "rsvp.html";
  }

  function goedit()
  {
    window.location.href = "edit-profile.html";
  }
    
  function gosettings()
  {
    window.location.href = "dashboard.html";
  }
    
  
  function logout()
  {
    window.location.href = "logout.html";
  }


  $("#prime1").on('click', function(){
	alert("hi");
  })
	
  </script>
  
  
    <script type="text/javascript" src="jquery-2.1.4.js"></script>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript">
    var allowstatus = 0;
  
    var firstname;
    var occupation;
    var area;
    var headline;
  var prime;
  var memberid;

  var i_memberid;
    var i_PhoneNumber;
    var i_Gender;
    var i_SeekingGender;
  var i_DOB;  
  
  var currentImageId;
  var currentImageURL;
  
  var currentfile='empty.jpg';
  var currentfolder;
  
  var pictureSource;   // picture source
  var destinationType; // sets the format of returned value 
    
    // Wait for Cordova to load
    //
    document.addEventListener("deviceready", onDeviceReady, false);
    // Cordova is ready
    //
    function onDeviceReady() {
        console.log("On Device Ready is Called...................");

        pictureSource=navigator.camera.PictureSourceType;
        destinationType=Camera.DestinationType.NATIVE_URI;  

    
        i_memberid = window.sessionStorage.getItem("memberid", i_memberid);
        i_PhoneNumber = window.sessionStorage.getItem("PhoneNumber", i_PhoneNumber);
        i_Gender = window.sessionStorage.getItem("Gender", i_Gender);
        i_SeekingGender = window.sessionStorage.getItem("SeekingGender", i_SeekingGender);
        i_DOB = window.sessionStorage.getItem("DOB", i_DOB);

    loadprofile();
    }

  function saveprofile()
  {
      
        firstname = $("#firstname").val();
    occupation = $("#occupation").val();
    area = $("#area").val();
    headline = $("#headline").val();
    image1 = document.getElementById("image1");
    image2 = document.getElementById("image2");
    image3 = document.getElementById("image3");
    prime = document.getElementById("prime1").value;
    

    //alert(firstname +  " - "  + occupation +  " - "  + area +  " - "  + headline +  " - "  + memberid);
    
        $.ajax({
            url: "http://18.219.77.161/api/saveprofile.php",
            type: "POST",
            dataType: "JSON",
            data: '{"firstname":"' + firstname + '","occupation":"' + occupation + '","area":"' + area + '","headline":"' + headline + '","prime":"' + prime + '","memberid":"' + i_memberid + '"}',
            success: function(jsonStr) {

                var jsonstr = JSON.stringify(jsonStr);

                var jsonobject = JSON.parse(jsonstr);
        
                var result;

                for (i = 1; i < jsonobject.length; i++) {
                    result = jsonobject[i].result;
                }

                if (result == "PASS") 
        {
          //app.dialog.alert('<br>Profile has been updated!');
          window.location.href = "myprofile.html";
                } 
        else 
        {
          //app.dialog.alert('<br>Profile not updated!');
          window.location.href = "myprofile.html";
        }


            },
            error: function(requestObject, error, errorThrown) {
                alert(error);
                alert(errorThrown);
            }
        });

    
    
  }


  function loadprofile()
  { 
        $.ajax({
            url: "http://18.219.77.161/api/loadprofile.php",
            type: "POST",
            dataType: "JSON",
            data: '{"memberid":"' + i_memberid + '"}',
            success: function(jsonStr) {

                var jsonstr = JSON.stringify(jsonStr);

                var jsonobject = JSON.parse(jsonstr);
        
                var result;

                for (i = 1; i < jsonobject.length; i++) {
                    result = jsonobject[i].result;
                }

                if (result == "FAIL") 
        {
          
          
                } 
        else 
        {

                    for (i = 1; i < jsonobject.length; i++) {
                        p_id = jsonobject[i].id;
                        p_MemberID = jsonobject[i].MemberID;
                        p_Name = jsonobject[i].Name;
                        p_Neighborhood = jsonobject[i].Neighborhood;
                        p_Occupation = jsonobject[i].Occupation;
                        p_Headline = jsonobject[i].Headline;            
                        p_DateCreated = jsonobject[i].DateCreated;            
                        p_DateUpdated = jsonobject[i].DateUpdated;    


            document.getElementById('firstname').value = p_Name;  
            document.getElementById('occupation').value = p_Occupation; 
            document.getElementById('area').value = p_Neighborhood; 
            document.getElementById('headline').value = p_Headline; 
			
		var abc=imageExists("http://18.219.77.161/api/upload/" + p_MemberID + "_PhotoSeq_1_color.jpg");
			if (abc)
			{
			document.getElementById("image1").src = "http://18.219.77.161/api/upload/" + p_MemberID + "_PhotoSeq_1_color.jpg";
			}

		abc=imageExists("http://18.219.77.161/api/upload/" + p_MemberID + "_PhotoSeq_2_color.jpg");
			if (abc)
			{			
			document.getElementById("image2").src = "http://18.219.77.161/api/upload/" + p_MemberID + "_PhotoSeq_2_color.jpg";
			}
			
		abc=imageExists("http://18.219.77.161/api/upload/" + p_MemberID + "_PhotoSeq_3_color.jpg");
			if (abc)
			{				
			document.getElementById("image3").src = "http://18.219.77.161/api/upload/" + p_MemberID + "_PhotoSeq_3_color.jpg";
			}
			
                    }

            
            
        }


            },
            error: function(requestObject, error, errorThrown) {
                alert(error);
                alert(errorThrown);
            }
        });

  }
  
  function loadimage(img)
  {
    // Vertical Buttons
    
    currentImageId = img;
    
      app.dialog.create({
      title: 'Image Selection',
      text: '',
      buttons: [
        {
        text: 'Capture From Camera',
        },
        {
        text: 'From Photo Library',
        },
      ],
      verticalButtons: true,
            onClick: function(dialog, index) {
                
        if (index == 0)
        {
          capturePhoto();
        }     
                else if (index == 1)
        {
          getPhotoFromLibrary();
        }


            }
      }).open();

  }

  
  function capturePhoto()
  {
    navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 50 });
  }
  
  function getPhotoFromLibrary()
  {
    getPhoto(pictureSource.PHOTOLIBRARY);
    }

  
    function getPhoto(source) {
      // Retrieve image file location from specified source
      navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 50, 
        destinationType: destinationType.FILE_URI,
        sourceType: source });
    }

    function onPhotoURISuccess(imageURI) {
  
    currentImageURL = imageURI;
    //alert(currentImageURL);
    
    var largeImage = document.getElementById(currentImageId);

    largeImage.style.display = 'block';

    largeImage.src = imageURI;    

    uploadPhoto(imageURI);
	
		if (currentImageId == "image1")
		{
		  i_fileName = i_memberid + "_PhotoSeq_1_color.jpg";
		  i_seq = 1;
		  i_bw="NO";
		}
		else if (currentImageId == "image2")
		{
		  i_fileName = i_memberid + "_PhotoSeq_2_color.jpg";
		  i_seq = 2;
		  i_bw="NO";
		}
		else if (currentImageId == "image3")
		{
		  i_fileName = i_memberid + "_PhotoSeq_3_color.jpg";
		  i_seq = 3;
		  i_bw="NO";
		}
		else
		{
		  i_fileName = imageURI.substr(imageURI.lastIndexOf('/') + 1);
		  i_seq = 4;
		  i_bw="NO";
		}
		
	updateRecord(i_memberid, i_fileName, i_seq, i_bw);
    }
  

    function onFail(message) {
      alert('Failed because: ' + message);
    }

  

    function uploadPhoto(imageURI) {
        var options = new FileUploadOptions();
        options.fileKey = "file";
        //options.fileName = imageURI.substr(imageURI.lastIndexOf('/') + 1);
    
    if (currentImageId == "image1")
    {
      options.fileName = i_memberid + "_PhotoSeq_1_color";
        }
    else if (currentImageId == "image2")
    {
      options.fileName = i_memberid + "_PhotoSeq_2_color";
        }
    else if (currentImageId == "image3")
    {
      options.fileName = i_memberid + "_PhotoSeq_3_color";
        }
    else
    {
      options.fileName = imageURI.substr(imageURI.lastIndexOf('/') + 1);
        }
    
    options.mimeType = "image/jpeg";
        console.log(options.fileName);
        var params = new Object();
        params.value1 = "test";
        params.value2 = "param";

        options.params = params;
        options.chunkedMode = false;

        var ft = new FileTransfer();
        ft.upload(imageURI, "http://18.219.77.161/api/upload.php", function(result){
            console.log(JSON.stringify(result));
        }, function(error){
            console.log(JSON.stringify(error));
        }, options);
    }
	
	function updateRecord(i_memberid, i_fileName, i_seq, i_bw)
	{

        $.ajax({
            url: "http://18.219.77.161/api/updatephoto.php",
            type: "POST",
            dataType: "JSON",
            data: '{"memberid":"' + i_memberid + '","photoseq":"' + i_seq + '","isbw":"' + i_bw + '","photourl":"' + i_fileName + '"}',
            success: function(jsonStr) {

                var jsonstr = JSON.stringify(jsonStr);

                var jsonobject = JSON.parse(jsonstr);
        
                var result;

                for (i = 1; i < jsonobject.length; i++) {
                    result = jsonobject[i].result;
                }

				console.log("Success photo update");

            },
            error: function(requestObject, error, errorThrown) {
                alert(error);
                alert(errorThrown);
            }
        });
	
	}



	function imageExists(image_url){
		
		var http = new XMLHttpRequest();

		http.open('HEAD', image_url, false);
		http.send();

		return http.status != 404;

	}

	function deleteimage(id)
	{
		alert(id);
	}

    </script>    
  
  
</body>

</html>
