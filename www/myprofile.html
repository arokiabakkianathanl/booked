<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#2196f3">
  <meta http-equiv="Content-Security-Policy" content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data: gap:">
  <title>Booked</title>
  <link rel="stylesheet" href="dist/css/framework7.min.css">
  <link rel="stylesheet" href="css/app.css">
  <link rel="apple-touch-icon" href="img/f7-icon-square.png">
  <link rel="icon" href="img/f7-icon.png">
</head>

<body class="color-theme-red" onload="init();">
  <div id="app">
    <div class="statusbar"></div>
    <div class="view view-main view-init ios-edges navbar-custom" data-url="/">
      <div class="page">
        <div class="navbar">
          <div class="navbar-inner sliding">
            <div class="left header-section">
              <img src="img/booked_logo.jpg" class="navbar-logo">
              <div id="q_name"></div>
            </div>
            <div class="right my-profile-navabar" onclick="goedit();">
                            <a href="#">
                <img src="img/avatar.jpg" class="img-circle">
              <span>Edit</span>
              </a>
            </div>
          </div>
        </div>
        <div class="page-content hide-navbar-on-scroll white-bg pb-xlg">
          <div class="block">
            <div class="row pt-lg">
              <div class="col-50">
                <div id="image1div" class="myProfile-img flex-center">
                  <img id="image1" onclick="showimageslider();" src="" class="img-respdonsive">
                </div>
				<span class="myProfile-img-span" id="imgcounter"></span>
              </div>
              <div class="col-50">
                <div class="row mb-lg">
                  <div class="col-50 right-align"> How Genuine is she?</div>
                  <div class="col-50">
                    <div class="flex-center">
                      <div id="circle1" class="ProgressBar"><strong class="percent"></strong></div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-50 right-align"> Odds of booking a date with her:</div>
                  <div class="col-50">
                    <div class="flex-center">
                      <div id="circle2" class="ProgressBar"><strong class="percent"></strong></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <p class="text-center mt-lg mb-sm f-20 text-black" id="q_occupation"></p>
            <div class="row">
              <div class="col-50 text-center">
                <p class="grey-text f-18 mt-sm mb-xs" id="q_place"></p>
              </div>
              <div class="col-50 text-center">
                <p class="text-color-red f-28 mt-xs mb-xs" id="q_age"></p>
              </div>
            </div>
            <div class="pl-sm pr-sm">
              <div class="row">
                <div class="col-5">
                  <p class="f-18 mt-sm mb-sm text-black"></p>
                </div>
                <div class="col-90">
                  <p class="f-18 mt-sm mb-sm text-black" style="font-family:'Courier';font-size: 18px;font-weight: 500;" id="q_desc"></p>
                </div>
                <div class="col-5">
                  <p class="f-18 mt-sm mb-sm text-black"></p>
                </div>
              </div>
            </div>
                        <a href="#" class="col button button-big button-fill red-bg-button button-block link external mt-lg">Edit My Profile</a>
                        <br>
          </div>
        </div>
        <div class="toolbar tabbar-labels">
          <div class="toolbar-inner">
            <a href="#tab-1" class="tab-link tab-link-active"><i class="icon f7-icons ios-only">info_fill</i><span class="tabbar-label">Alerts</span></a>
            <a href="#tab-2" onclick="finddates();" class="tab-link"><i class="icon material-icons">my_location<span class="badge color-red">5</span></i><span class="tabbar-label">Find Dates</span></a>
            <a href="#tab-3" onclick="gosettings();" class="tab-link"><i class="icon f7-icons ios-only">alarm</i><span class="tabbar-label">My Schedule</span></a>
            <a href="#tab-4" onclick="gopostevent();" class="tab-link"><i class="icon material-icons ios-only">open_in_new</i><span class="tabbar-label">Post a Date</span></a>
            <a href="#tab-5" onclick="chat();" class="tab-link"><i class="icon material-icons ios-only">question_answer</i><span class="tabbar-label">Chat</span></a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <style type="text/css">
    .myProfile-img-span{
      opacity: 0;
    }
  </style>
  <script src="dist/js/framework7.min.js"></script>
  <script src="js/routes.js"></script>
  <script src="js/app.js"></script>
  <script type="text/javascript">
  
	function init()
	{		
		app.dialog.preloader();
	}
	
  function finddates() {
    window.location.href = "search.html";
  }

  function chat() {
    window.location.href = "rsvp.html";
  }

  function goedit() {
    window.location.href = "edit-profile.html";
  }

  function gosettings() {
    window.location.href = "settings.html";
  }


  function logout() {
    window.location.href = "logout.html";
  }

	function gopostevent()
	{
		window.location.href = "postanevent.html";
	}   
  
  </script>
  <script type="text/javascript" src="jquery-2.1.4.js"></script>
  <script src="js/progressbar.js"></script>
  <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
  <script type="text/javascript">
  var allowstatus = 0;

  var firstname;
  var occupation;
  var area;
  var headline;
  var prime;
  var memberid;

  var i_id;
  var i_memberid;
  var i_iam;
  var i_interested;
  var i_phone;
  var i_dob;
  var i_activationcode;
  var i_age;

  var currentImageId;
  var currentImageURL;

  var currentfile = 'empty.jpg';
  var currentfolder;

  var pictureSource; // picture source
  var destinationType; // sets the format of returned value 

  var myPhotoBrowserStandalone;  
 
  var photo_id = {};
  var photo_MemberID = {};
  var photo_PhotoSeq = {};
  var photo_IsBW = {};
  var photo_PhotoURL = {};
  var photo_IsPrimary = {};
  var photo_DateUpdated = {};

  
  var displayed_images = 1;

  // Wait for Cordova to load
  //
  document.addEventListener("deviceready", onDeviceReady, false);
  // Cordova is ready
  //
  function onDeviceReady() {
    console.log("On Device Ready is Called...................");

    // app.preloader.show();

    pictureSource = navigator.camera.PictureSourceType;
    destinationType = Camera.DestinationType.NATIVE_URI;

    i_memberid = window.sessionStorage.getItem("memberid", i_memberid);
    i_iam = window.sessionStorage.getItem("iam", i_iam);
    i_interested = window.sessionStorage.getItem("interested", i_interested);
    i_phone = window.sessionStorage.getItem("phone", i_phone);
    i_dob = window.sessionStorage.getItem("dob", i_dob);


    var myDate = new Date(i_dob);


    i_age = calculateAge(myDate);

    loadphotoprofile();

    loadprofile();
    circleLoader();

    myVar = setTimeout(imageResize, 4000);

	if (displayed_images == 2)
	{
		var x = document.getElementById("imgcounter");
		x.style.display = "none";
	}

    document.getElementById("imgcounter").innerHTML = "<b>+" + (displayed_images-2) + "</b>";
	
	
	var photos = [];
	
	for (ip=1; ip < displayed_images; ip++)
	{
		photos.push("http://18.219.77.161/api/upload/" +  photo_PhotoURL[ip]);
	}	
	
		myPhotoBrowserStandalone = app.photoBrowser.create({
			photos : photos
		});		
	
			  setTimeout(function () {
				app.dialog.close();
			  }, 500);
  
  }




  function loadphotoprofile() {

    $.ajax({
      url: "http://18.219.77.161/api/loadphotoprofile.php",
      type: "POST",
      dataType: "JSON",
      async: false,
      data: '{"memberid":"' + i_memberid + '"}',
      success: function(jsonStr) {

        var jsonstr = JSON.stringify(jsonStr);

        var jsonobject = JSON.parse(jsonstr);

        var result;

		displayed_images = jsonobject.length;
		
        for (i = 1; i < jsonobject.length; i++) {
          result = jsonobject[i].result;
        }

        if (result == "FAIL") {

        } else {

          for (i = 1; i < jsonobject.length; i++) {
            photo_id[i] = jsonobject[i].id;
            photo_MemberID[i] = jsonobject[i].MemberID;
            photo_PhotoSeq[i] = jsonobject[i].PhotoSeq;
            photo_IsBW[i] = jsonobject[i].IsBW;
            photo_PhotoURL[i] = jsonobject[i].PhotoURL;
            photo_IsPrimary[i] = jsonobject[i].IsPrimary;
            photo_DateUpdated[i] = jsonobject[i].DateUpdated;

            console.log(photo_PhotoURL[i]);
          }
        }
      },
      error: function(requestObject, error, errorThrown) {
        alert(error);
        alert(errorThrown);
      }
    });
  }

  function loadprofile() {
    $.ajax({
      url: "http://18.219.77.161/api/loadprofile.php",
      type: "POST",
      dataType: "JSON",
      data: '{"memberid":"' + i_memberid + '"}',
      success: function(jsonStr) {

        var jsonstr = JSON.stringify(jsonStr);

        var jsonobject = JSON.parse(jsonstr);

        var result;

        for (i = 1; i < jsonobject.length; i++) {
          result = jsonobject[i].result;
        }

        if (result == "FAIL") {


        } else {

          for (i = 1; i < jsonobject.length; i++) {
            p_id = jsonobject[i].id;
            p_MemberID = jsonobject[i].MemberID;
            p_Name = jsonobject[i].Name;
            p_Neighborhood = jsonobject[i].Neighborhood;
            p_Occupation = jsonobject[i].Occupation;
            p_Headline = jsonobject[i].Headline;
            p_DateCreated = jsonobject[i].DateCreated;
            p_DateUpdated = jsonobject[i].DateUpdated;
		
            document.getElementById("q_name").innerHTML = "<b>Meet " + p_Name + " (Me) ....</b>";
            document.getElementById("q_occupation").innerHTML = p_Occupation;
            document.getElementById("q_place").innerHTML = "<i>" + p_Neighborhood + "</i>";
            document.getElementById("q_desc").innerHTML = '\"' + p_Headline + '\"';
            document.getElementById("q_age").innerHTML = "<b>Age: " + i_age + "</b>";			
			

            var abc = imageExists("http://18.219.77.161/api/upload/" + photo_PhotoURL[1]);
            if (abc && photo_PhotoURL[1] != "") {
              document.getElementById("image1").src = "http://18.219.77.161/api/upload/" + photo_PhotoURL[1];
            } else {
              document.getElementById("image1").src = "img/noimage.jpg";

            }

          }

        }

	
      },
      error: function(requestObject, error, errorThrown) {
        alert(error);
        alert(errorThrown);
      }
    });

  }



  function imageExists(image_url) {

    var http = new XMLHttpRequest();

    http.open('HEAD', image_url, false);
    http.send();

    return http.status != 404;

  }



  function calculateAge(birthday) { // birthday is a date
    var ageDifMs = Date.now() - birthday.getTime();
    var ageDate = new Date(ageDifMs); // miliseconds from epoch
    return Math.abs(ageDate.getUTCFullYear() - 1970);
  }
  // jQuery.noConflict();
  function imageResize() {

    $(".myProfile-img > img").each(function() {
      var nwidth = $(this).width();
      var nheight = $(this).height();
      if (nwidth > nheight) {
        $(this).css({ "width": "100%", "height": "auto", "opacity": "1" });
        var absheight = ((200 - $(this).height()) / 2) + $(this).height(); 
      } else if (nwidth < nheight) {
        $(this).css({ "width": "auto", "height": "100%", "opacity": "1" });
        var absheight = $(this).height();
      } else if (nwidth == nheight) {
        $(this).css({ "width": "auto", "height": "100%", "opacity": "1" });
        var absheight = $(this).height();
      }
      var offimgleft = $(this).offset();
      var offimggleft = (offimgleft.left + $(".myProfile-img > img").width())-30; 

      $(this).parent().next().css({ "left": +offimggleft + "px", "top": +absheight + "px", "opacity": "1", "position": "absolute" });
      app.preloader.hide();
    });
  }

  function circleLoader() {
    $('#circle1').circleProgress({
      value: 0.75,
      size: 50,
      fill: { color: '#000000' }
    }).on('circle-animation-progress', function(event, progress, stepValue) {
      $(this).find('strong').html(Math.round(75 * progress) + '<i>%</i>');
    });
    $('#circle2').circleProgress({
      value: 0.33,
      size: 50,
      fill: { color: '#000000' }
    }).on('circle-animation-progress', function(event, progress, stepValue) {
      $(this).find('strong').html(Math.round(33 * progress) + '<i>%</i>');
    });
  }
  
  
function showimageslider()
{
	myPhotoBrowserStandalone.open();
}
  </script>
</body>

</html>
